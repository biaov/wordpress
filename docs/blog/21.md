# æ­å»º Vite + Vue3 + TypeScript + Electron é¡¹ç›®

- æºç å‚è€ƒï¼š[mine-desktop](https://github.com/biaov/mine-desktop)ï¼Œå¦‚æœä»¥ä¸‹æœ‰äº›è®¸ç»†èŠ‚æ²¡æœ‰è¡¨è¾¾å‡ºæ¥ï¼Œå¯ä»¥å‚è€ƒæ­¤æºç ã€‚

## æ–¹æ³•ä¸€ã€åˆ›å»ºä¸€ä¸ª Vite é¡¹ç›®

```Basic
npm init vite@latest
```

## æ–¹æ³•äºŒã€ä»é›¶å¼€å§‹

### åˆå§‹åŒ– package.json

```JSON
npm init -y
```

### å®‰è£…ä¾èµ–

#### å®‰è£… vue ä¾èµ–

```Basic
npm i vue vue-router
```

- å®‰è£…æ„å»ºå·¥å…·
- è¿™é‡Œä½¿ç”¨ Less ä½œä¸º css é¢„ç¼–è¯‘å™¨

```Basic
npm i -D @vitejs/plugin-vue vite less
```

#### å®‰è£… TS ä¾èµ–

```Basic
npm i -D typescript vue-tsc @types/node
```

#### å®‰è£… Electron ä¾èµ–

- è¿™é‡Œä½¿ç”¨ `electron-builder` ä½œä¸ºæ‰“åŒ…å·¥å…·

```Basic
npm i -D electron electron-builder
```

#### å®‰è£… Eslint (å¯é€‰)

```Basic
npm i -D @typescript-eslint/eslint-plugin @typescript-eslint/parser @vitejs/plugin-vue eslint eslint-config-airbnb-base eslint-config-prettier eslint-plugin-import eslint-plugin-prettier eslint-plugin-vue prettier
```

### åˆå§‹åŒ–æ–‡ä»¶

<details>
<summary>ğŸ‘€ vite.config.ts</summary>

```TypeScript
import { defineConfig, UserConfig } from 'vite'
import { resolve } from 'path'
import vue from '@vitejs/plugin-vue'

export const config: UserConfig = {
  base: './',
  plugins: [vue()],
  resolve: {
    // è·¯å¾„åˆ«å
    alias: {
      '@': resolve(__dirname, './src')
    }
  },
  css: {
    // é…ç½®é¢„ç¼–è¯‘å™¨
    preprocessorOptions: {
      less: {
        javascriptEnabled: true,
        additionalData: `@import '@/styles/variables.less';`
      }
    }
  },
  build: {
    outDir: './dist/resources/vue',
    sourcemap: false
  }
}

export default defineConfig(config)
```

</details>

<details>
<summary>ğŸ‘€ tsconfig.json</summary>

```JSON
{
  "compilerOptions": {
    "incremental": false,
    "composite": false,
    "target": "esnext",
    "useDefineForClassFields": true,
    "module": "esnext",
    "moduleResolution": "node",
    "strict": true,
    "jsx": "preserve",
    "sourceMap": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "esModuleInterop": true,
    "lib": ["esnext", "dom"],
    "types": ["vite/client", "node"],
    "skipLibCheck": true,
    "baseUrl": "./",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src/**/*.ts", "src/**/*.d.ts", "src/**/*.tsx", "src/**/*.vue", "vite.config.ts", "app/**/*.ts"]
}
```

</details>

<details>
<summary>ğŸ‘€ æ ¹ç›®å½•</summary>

```Markdown
|-- electron-demo --------------------- é¡¹ç›®åç§°
    |-- index.html -------------------- HTML é¡µé¢
    |-- tsconfig.json ----------------- TS é…ç½®
    |-- vite.config.ts ---------------- Vite é…ç½®
    |-- app --------------------------- Electron ä¸»ç›®å½•
    |   |-- vite.config.ts ------------ å…³äº Electron çš„ Vite åŸºç¡€é…ç½®
    |   |-- assets -------------------- èµ„æºç›®å½•
    |   |   |-- 256x256.ico ----------- åº”ç”¨å›¾æ ‡
    |   |   |-- 256x256.png ----------- åº”ç”¨å›¾æ ‡
    |   |-- main ---------------------- ä¸»ç¨‹åºæ ¹ç›®å½•
    |   |   |-- vite.config.ts -------- ä¸»ç¨‹åºçš„ Vite é…ç½®
    |   |   |-- src ------------------- ä¸»ç¨‹åºç›®å½•
    |   |       |-- main.ts ----------- ä¸»ç¨‹åºå…¥å£
    |   |-- preload ------------------- Electron é¢„åŠ è½½ç›®å½•
    |       |-- vite.config.ts -------- é¢„åŠ è½½çš„ Vite é…ç½®
    |       |-- src ------------------- é¢„åŠ è½½ç¨‹åºç›®å½•
    |           |-- bridge.ts --------- bridge æ¨¡å—
    |           |-- index.ts ---------- é¢„åŠ è½½ç¨‹åºå…¥å£
    |-- public ------------------------ é™æ€èµ„æº
    |   |-- favicon.ico --------------- favicon
    |-- src --------------------------- vue é¡¹ç›®
        |-- App.vue ------------------- é¡µé¢å…¥å£
        |-- env.d.ts ------------------ TS æ¨¡æ¿å£°æ˜
        |-- main.ts ------------------- å…¥å£
        |-- assets -------------------- èµ„æºç›®å½•
        |-- components ---------------- å…¬å…±ç»„ä»¶
        |-- router -------------------- è·¯ç”±
        |-- styles -------------------- æ ·å¼
        |-- views --------------------- é¡µé¢
```

</details>

<details>
<summary>ğŸ‘€ main.ts</summary>

```TypeScript
import { createApp } from 'vue'
import Antd from 'ant-design-vue'
import router from './router'
import App from './App.vue'

const app = createApp(App)

app.use(router)
app.mount('#app')
```

</details>

## æ€è·¯

### Vue é¡¹ç›®

- ä¿æŒåŸæœ‰ç›®å½•ä¸å˜ï¼Œåœ¨æ­¤åŸºç¡€ä¸ŠåŠ å…¥ `Electron` é…ç½®ã€‚
- æ­¤è½¯ä»¶çš„ç•Œé¢éƒ½ä½¿ç”¨ Vue é¡µé¢ï¼Œå’Œ Electron æ²¡æœ‰ä»»ä½•å…³ç³»ï¼ŒElectron åªåšä»£ç äº¤äº’ã€‚

### Electron é¡¹ç›®

- æ”¯æŒ TSï¼šä¸»è¦é€šè¿‡ vite æ¥æ‰“åŒ… Electron ç¨‹åºä¸º libï¼Œä»è€Œè¾¾åˆ°å®ç°å¼€å‘ä¸º TS çš„ç›®çš„ã€‚

### Vue å’Œ Electron é€šä¿¡

#### Electron å®šä¹‰

<details>
<summary>ğŸ‘€ app/main/src/main.ts</summary>

```TypeScript
import { app, BrowserWindow, BrowserWindowConstructorOptions, ipcMain } from 'electron'
import { resolve } from 'path'

// åˆå§‹åŒ–ç¨‹åº

/**
 * åˆ›å»ºçª—å£
 */
const createWindow = () => {
  const browserWindowOption: BrowserWindowConstructorOptions = {
    titleBarStyle: 'hidden',
    width: 1000,
    height: 600,
    webPreferences: {
      nodeIntegration: true,
      enableWebSQL: false,
      preload: resolve(__dirname, '../preload/index.cjs') // é¢„åŠ è½½ç¨‹åºï¼Œæ­¤ä¸º `preload/src/index.ts` ä½¿ç”¨ Vite æ‰“åŒ…ä¹‹åçš„ lib æ–‡ä»¶
    }
  }
  const window = new BrowserWindow(browserWindowOption)

  window.setMenuBarVisibility(false)

  let pageUrl: string // é¡µé¢è·¯å¾„
  // å¼€å‘
  if (import.meta.env.MODE === 'development') {
    pageUrl = 'http://localhost:3400'
    window.webContents.openDevTools()
  } else {
    pageUrl = new URL('../../resources/vue/index.html', `file://${__dirname}`).toString() // æ‰“åŒ…
  }
  window.loadURL(pageUrl)
  // å®šä¹‰é€šä¿¡äº‹ä»¶, quit ä¸ºè‡ªå®šä¹‰åç§°
  ipcMain.handle('quit', () => {
    app.quit()
  })
}

app.whenReady().then(() => {
  createWindow()
  app.on('activate', function () {
    !BrowserWindow.getAllWindows().length && createWindow()
  })
})

app.on('window-all-closed', () => {
  process.platform !== 'darwin' && app.quit()
})
```

</details>

- å®šä¹‰é€šä¿¡äº‹ä»¶

```TypeScript
// å®šä¹‰é€šä¿¡äº‹ä»¶, quit ä¸ºè‡ªå®šä¹‰åç§°ï¼Œæ³¨æ„åœ¨ Vue é‡Œä½¿ç”¨çš„æ—¶å€™ä¿æŒä¸€è‡´
ipcMain.handle('quit', () => {
  app.quit()
})
```

<details>
<summary>ğŸ‘€ app/preload/src/bridge.ts</summary>

```TypeScript
import { contextBridge, ipcRenderer } from 'electron'
// electron æ˜¯ä¸º Vue æ³¨å…¥å…¨å±€å˜é‡ electron, ipcRenderer ä¸ºæ³¨å…¥çš„æ¨¡å—
contextBridge.exposeInMainWorld('electron', {
  ipcRenderer
})
```

</details>

#### Vue ä½¿ç”¨

```Vue
<template>
  <div @click="onQuit">å…³é—­è½¯ä»¶</div>
</template>
<script lang="ts" setup>
const onQuit = () => {
  // electron å±æ€§ä¸º Electron æ³¨å…¥çš„å…¨å±€å˜é‡
  // quit ä¸º Electron å®šä¹‰çš„åç§°
  globalThis.electron.ipcRenderer.invoke('quit')
}
</script>
```

### Electron æ‰“åŒ…é…ç½®

<details>
<summary>ğŸ‘€ electron-builder.json æˆ– package.json çš„ build</summary>

```JSON
{
  "appId": "mine.desktop.app",
  "electronVersion": "19.0.4",
  "copyright": "Copyright (c) 2022-present biaov",
  "asar": true,
  "directories": {
    "output": "./dist/package"
  },
  "win": {
    "icon": "./app/assets/256x256.ico",
    "requestedExecutionLevel": "highestAvailable",
    "target": [
      {
        "target": "nsis",
        "arch": ["x64"]
      }
    ]
  },
  "nsis": {
    "allowElevation": true,
    "allowToChangeInstallationDirectory": true,
    "artifactName": "mine-desktop.${ext}",
    "createDesktopShortcut": true,
    "createStartMenuShortcut": true,
    "installerIcon": "./app/assets/256x256.ico",
    "uninstallerIcon": "./app/assets/256x256.ico",
    "installerHeaderIcon": "./app/assets/256x256.ico",
    "uninstallDisplayName": "uninstall",
    "oneClick": false,
    "shortcutName": "mine-desktop",
    "useZip": true,
    "deleteAppDataOnUninstall": false,
    "displayLanguageSelector": false,
    "perMachine": true
  }
}
```

```JSON
{
  "name": "electron-demo",
  "version": "1.0.0",
  "scripts": {},
  "build": {
    "appId": "mine.desktop.app",
    ...åŒä¸Š
  }
}
```

</details>

## æ€»ç»“

- æ€»ä½“ä¸Šæ¥è¯´ï¼Œå¦‚æœä½ ä¸ç”¨ Electron è‡ªå¸¦çš„ç•Œé¢ï¼Œé‚£ä¹ˆé™¤äº†äº¤äº’ï¼Œå…¶å®ƒçš„å’Œ Vue é¡¹ç›®æ²¡æœ‰åŒºåˆ«ã€‚
- æºç å‚è€ƒï¼š[mine-desktop](https://github.com/biaov/mine-desktop)ï¼Œå¦‚æœä»¥ä¸Šæœ‰äº›è®¸ç»†èŠ‚æ²¡æœ‰è¡¨è¾¾å‡ºæ¥ï¼Œå¯ä»¥å‚è€ƒæ­¤æºç ã€‚
